{% extends "layout/basic.html" %}
{% block title %}{{ contest.title or ('比赛 ' + contest.id) }} - 查重详情{% endblock %}

{% block content %}
<style>
/* 比赛详情页面样式 */
.contest-detail-container {
  max-width: 1400px;
  margin: 20px auto;
  padding: 0 20px;
}

.page-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 40px 30px;
  border-radius: 16px;
  margin-bottom: 30px;
  position: relative;
  overflow: hidden;
}

.page-header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 30px,
    rgba(255,255,255,0.1) 30px,
    rgba(255,255,255,0.1) 60px
  );
  animation: headerAnimation 15s linear infinite;
}

@keyframes headerAnimation {
  0% { transform: translateX(-100px) translateY(-100px) rotate(0deg); }
  100% { transform: translateX(100px) translateY(100px) rotate(360deg); }
}

.header-content {
  position: relative;
  z-index: 1;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.header-info h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin: 0 0 8px 0;
}

.header-subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
  margin: 0 0 16px 0;
}

.contest-meta {
  display: flex;
  gap: 24px;
  font-size: 14px;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 6px;
  opacity: 0.9;
}

.header-actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-white {
  background: white;
  color: #667eea;
  border: 2px solid transparent;
}

.btn-white:hover {
  background: #f8f9fa;
  transform: translateY(-2px);
}

.btn-outline-white {
  background: transparent;
  color: white;
  border: 2px solid white;
}

.btn-outline-white:hover {
  background: white;
  color: #667eea;
}

.stats-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-icon {
  width: 48px;
  height: 48px;
  margin: 0 auto 16px;
  padding: 12px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  color: white;
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: #2d3748;
  margin: 0 0 8px 0;
}

.stat-label {
  font-size: 14px;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 0;
}

.content-layout {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 30px;
}

.main-content {
  min-width: 0;
}

.sidebar {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.section-card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  overflow: hidden;
}

.section-header {
  padding: 20px 24px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-bottom: 2px solid #e9ecef;
}

.section-title {
  font-size: 1.3rem;
  font-weight: 700;
  color: #2d3748;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.section-content {
  padding: 24px;
}

.problems-grid {
  display: grid;
  gap: 16px;
}

.problem-card {
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  padding: 20px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.problem-card:hover {
  border-color: #667eea;
  background: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
}

.problem-header {
  display: flex;
  justify-content: between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.problem-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #2d3748;
  margin: 0 0 4px 0;
  flex: 1;
}

.problem-id {
  font-size: 13px;
  color: #6b7280;
  margin: 0;
}

.similarity-badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-left: 12px;
}

.similarity-high {
  background: #fee2e2;
  color: #991b1b;
}

.similarity-medium {
  background: #fef3c7;
  color: #92400e;
}

.similarity-low {
  background: #d1fae5;
  color: #065f46;
}

.similarity-none {
  background: #f3f4f6;
  color: #6b7280;
}

.problem-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

.problem-stat {
  text-align: center;
  padding: 8px;
  background: white;
  border-radius: 8px;
}

.problem-stat-value {
  font-size: 1.2rem;
  font-weight: 600;
  color: #667eea;
  margin: 0 0 4px 0;
}

.problem-stat-label {
  font-size: 11px;
  color: #6b7280;
  text-transform: uppercase;
  margin: 0;
}

.problem-languages {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.language-tag {
  padding: 4px 8px;
  background: #667eea;
  color: white;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 500;
}

.info-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  border: 2px solid #e9ecef;
}

.info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #f1f3f4;
}

.info-item:last-child {
  border-bottom: none;
}

.info-label {
  font-weight: 600;
  color: #4a5568;
  font-size: 14px;
}

.info-value {
  color: #6b7280;
  font-size: 14px;
}

.actions-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  border: 2px solid #e9ecef;
}

.action-btn {
  width: 100%;
  margin-bottom: 12px;
  justify-content: center;
}

.action-btn:last-child {
  margin-bottom: 0;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
  background: #f8f9fa;
  color: #495057;
  border: 2px solid #e9ecef;
}

.btn-secondary:hover {
  background: #e9ecef;
  transform: translateY(-1px);
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #6b7280;
}

.empty-icon {
  width: 64px;
  height: 64px;
  margin: 0 auto 20px;
  opacity: 0.5;
}

.error-message {
  background: #fee2e2;
  border: 2px solid #fecaca;
  color: #991b1b;
  padding: 16px 20px;
  border-radius: 12px;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.breadcrumb {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 20px;
  font-size: 14px;
  color: #6b7280;
}

.breadcrumb a {
  color: #667eea;
  text-decoration: none;
}

.breadcrumb a:hover {
  text-decoration: underline;
}

.breadcrumb-separator {
  color: #d1d5db;
}

/* 响应式设计 */
@media (max-width: 1024px) {
  .content-layout {
    grid-template-columns: 1fr;
  }
  
  .sidebar {
    order: -1;
  }
}

@media (max-width: 768px) {
  .contest-detail-container {
    padding: 0 15px;
  }
  
  .page-header {
    padding: 30px 20px;
  }
  
  .header-content {
    flex-direction: column;
    gap: 20px;
  }
  
  .header-info h1 {
    font-size: 2rem;
  }
  
  .contest-meta {
    flex-direction: column;
    gap: 8px;
  }
  
  .stats-overview {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .problem-stats {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .stats-overview {
    grid-template-columns: 1fr;
  }
  
  .problem-stats {
    grid-template-columns: 1fr;
  }
}
</style>

<div class="contest-detail-container">
  <!-- 面包屑导航 -->
  <div class="breadcrumb">
    <a href="/plagiarism">查重系统</a>
    <span class="breadcrumb-separator">›</span>
    <a href="/plagiarism/contest">比赛列表</a>
    <span class="breadcrumb-separator">›</span>
    <span>{{ contest.title or ('比赛 ' + contest.id) }}</span>
  </div>

  <!-- 错误提示 -->
  {% if error %}
  <div class="error-message">
    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
    </svg>
    <span>加载比赛详情时出错：{{ error }}</span>
  </div>
  {% endif %}

  {% if contest %}
  <!-- 页面头部 -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1>{{ contest.title or ('比赛 ' + contest.id) }}</h1>
        <p class="header-subtitle">代码查重分析详情</p>
        <div class="contest-meta">
          {% if contest.begin_at %}
          <div class="meta-item">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
            </svg>
            <span>开始时间：{{ contest.begin_at }}</span>
          </div>
          {% endif %}
          {% if contest.end_at %}
          <div class="meta-item">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
            </svg>
            <span>结束时间：{{ contest.end_at }}</span>
          </div>
          {% endif %}
        </div>
      </div>
      
      <div class="header-actions">
        <a href="/plagiarism/contest" class="btn btn-outline-white">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
          </svg>
          返回列表
        </a>
        <button class="btn btn-white" onclick="downloadReport()">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
          下载报告
        </button>
      </div>
    </div>
  </div>

  <!-- 统计概览 -->
  <div class="stats-overview">
    <div class="stat-card">
      <div class="stat-icon">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <div class="stat-value">{{ problems|length or 0 }}</div>
      <div class="stat-label">题目总数</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <div class="stat-value">{{ total_high_similarity or 0 }}</div>
      <div class="stat-label">高相似度对</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <div class="stat-value">{{ (avg_similarity * 100)|round|int if avg_similarity else 0 }}%</div>
      <div class="stat-label">平均相似度</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z" clip-rule="evenodd"></path>
          <path d="M15 7h1a2 2 0 012 2v5.5a1.5 1.5 0 01-3 0V9a1 1 0 00-1-1h-1v1z"></path>
        </svg>
      </div>
      <div class="stat-value">
        {% set total_submissions = 0 %}
        {% for problem in problems %}
          {% set total_submissions = total_submissions + (problem.total_submissions or 0) %}
        {% endfor %}
        {{ total_submissions }}
      </div>
      <div class="stat-label">总提交数</div>
    </div>
  </div>

  <!-- 主要内容布局 -->
  <div class="content-layout">
    <!-- 主内容区域 -->
    <div class="main-content">
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            题目查重结果
          </h2>
        </div>
        <div class="section-content">
          {% if problems and problems|length > 0 %}
          <div class="problems-grid">
            {% for problem in problems %}
            <div class="problem-card" data-contest-id="{{ contest.id }}" data-problem-id="{{ problem.id }}" style="cursor: pointer;">
              <div class="problem-header">
                <div>
                  <h3 class="problem-title">{{ problem.title or ('题目 ' + problem.id|string) }}</h3>
                  <p class="problem-id">ID: {{ problem.id }}</p>
                </div>
                <div class="similarity-badge {% if (problem.max_similarity or 0) >= 0.8 %}similarity-high{% elif (problem.max_similarity or 0) >= 0.5 %}similarity-medium{% elif (problem.max_similarity or 0) > 0 %}similarity-low{% else %}similarity-none{% endif %}">
                  {% if problem.max_similarity %}
                    {{ (problem.max_similarity * 100)|round|int }}% 相似
                  {% else %}
                    无数据
                  {% endif %}
                </div>
              </div>

              <div class="problem-stats">
                <div class="problem-stat">
                  <div class="problem-stat-value">{{ problem.total_submissions or 0 }}</div>
                  <div class="problem-stat-label">提交数</div>
                </div>
                <div class="problem-stat">
                  <div class="problem-stat-value">{{ problem.high_similarity_pairs or 0 }}</div>
                  <div class="problem-stat-label">高相似对</div>
                </div>
                <div class="problem-stat">
                  <div class="problem-stat-value">{{ problem.languages|length if problem.languages else 0 }}</div>
                  <div class="problem-stat-label">语言数</div>
                </div>
              </div>

              {% if problem.languages %}
              <div class="problem-languages">
                {% for lang in problem.languages %}
                  {% if loop.index <= 5 %}
                    <span class="language-tag">{{ lang }}</span>
                  {% endif %}
                {% endfor %}
                {% if problem.languages|length > 5 %}
                <span class="language-tag">+{{ problem.languages|length - 5 }}</span>
                {% endif %}
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state">
            <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 8l2 2 4-4"></path>
            </svg>
            <h3>暂无题目数据</h3>
            <p>该比赛还没有进行查重分析或没有题目数据。</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar">
      <!-- 比赛信息 -->
      <div class="info-card">
        <h3 style="margin-top: 0; color: #2d3748; font-size: 1.1rem;">比赛信息</h3>
        <div class="info-item">
          <span class="info-label">比赛ID</span>
          <span class="info-value">{{ contest.id }}</span>
        </div>
        {% if contest.owner %}
        <div class="info-item">
          <span class="info-label">创建者</span>
          <span class="info-value">{{ contest.owner }}</span>
        </div>
        {% endif %}
        {% if contest.attend %}
        <div class="info-item">
          <span class="info-label">参与人数</span>
          <span class="info-value">{{ contest.attend }}</span>
        </div>
        {% endif %}
        <div class="info-item">
          <span class="info-label">状态</span>
          <span class="info-value">{{ contest.status or '未知' }}</span>
        </div>
      </div>

      <!-- 快捷操作 -->
      <div class="actions-card">
        <h3 style="margin-top: 0; color: #2d3748; font-size: 1.1rem;">快捷操作</h3>
        <a href="/plagiarism/new" class="btn btn-primary action-btn">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          新建查重任务
        </a>
        <button class="btn btn-secondary action-btn" onclick="refreshData()">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
          </svg>
          刷新数据
        </button>
        <button class="btn btn-secondary action-btn" onclick="exportData()">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
          导出数据
        </button>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
// 立即定义全局函数，确保在任何 onclick 调用之前都可用
(function() {
  // 查看题目详情
  window.viewProblemDetail = function(contestId, problemId) {
    console.log('viewProblemDetail called with:', contestId, problemId);
    window.location.href = `/plagiarism/contest/${contestId}/${problemId}`;
  };
  
  // 立即验证函数是否已定义
  console.log('viewProblemDetail function defined:', typeof window.viewProblemDetail);
})();

// 下载报告
function downloadReport() {
  const contestId = '{{ contest.id }}';
  const link = document.createElement('a');
  link.href = `/plagiarism/contest/${contestId}/download`;
  link.download = `contest_${contestId}_plagiarism_report.json`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// 刷新数据
function refreshData() {
  window.location.reload();
}

// 导出数据
function exportData() {
  const contestId = '{{ contest.id }}';
  const data = {
    contest: {{ contest | dump if contest else '{}' | safe }},
    problems: {{ problems | dump if problems else '[]' | safe }},
    stats: {
      total_problems: {{ problems|length if problems else 0 }},
      total_high_similarity: {{ total_high_similarity if total_high_similarity else 0 }},
      avg_similarity: {{ avg_similarity if avg_similarity else 0 }}
    },
    export_time: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `contest_${contestId}_export.json`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
}

// 键盘快捷键
document.addEventListener('keydown', function(e) {
  // Escape 返回列表
  if (e.key === 'Escape') {
    window.location.href = '/plagiarism/contest';
  }
  
  // Ctrl+R 刷新
  if (e.ctrlKey && e.key === 'r') {
    e.preventDefault();
    refreshData();
  }
  
  // Ctrl+D 下载
  if (e.ctrlKey && e.key === 'd') {
    e.preventDefault();
    downloadReport();
  }
});

// 页面加载完成后的处理
document.addEventListener('DOMContentLoaded', function() {
  // 检查函数是否已定义
  if (typeof window.viewProblemDetail === 'function') {
    console.log('viewProblemDetail function is defined');
  } else {
    console.error('viewProblemDetail function is not defined!');
  }
  
  // 为题目卡片添加点击事件监听器
  const problemCards = document.querySelectorAll('.problem-card');
  problemCards.forEach((card) => {
    card.addEventListener('click', function() {
      const contestId = card.getAttribute('data-contest-id');
      const problemId = card.getAttribute('data-problem-id');
      console.log('Problem card clicked:', contestId, problemId);
      window.location.href = `/plagiarism/contest/${contestId}/${problemId}`;
    });
    
    // 添加键盘导航
    card.setAttribute('tabindex', '0');
    card.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        card.click();
      }
    });
  });
});
</script>

{% endblock %}
