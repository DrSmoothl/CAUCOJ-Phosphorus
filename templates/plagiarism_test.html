{% set page_name = "æ’ä»¶æµ‹è¯•" %}
{% extends "layout/basic.html" %}

{% block content %}
<div class="row">
  <div class="medium-12 columns">
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">Phosphorus æŠ„è¢­æ£€æµ‹æ’ä»¶æµ‹è¯•é¡µé¢</h1>
      </div>
      <div class="section__body">
        <div class="typo">
          <h2>æ’ä»¶çŠ¶æ€æ£€æŸ¥</h2>
          
          <div id="status-check">
            <h3>âœ… æ’ä»¶åŠ è½½çŠ¶æ€</h3>
            <p>å¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¯´æ˜æ’ä»¶å·²æˆåŠŸåŠ è½½åˆ° Hydro ç³»ç»Ÿä¸­ã€‚</p>
            
            <h3>ğŸ”— API è¿æ¥æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ä¸ Phosphorus åç«¯çš„è¿æ¥ï¼š</p>
            <button id="test-api" class="rounded primary button">æµ‹è¯• API è¿æ¥</button>
            <div id="api-result" style="margin-top: 10px;"></div>
            
            <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
              <li>ç¡®ä¿ Phosphorus åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆé»˜è®¤ç«¯å£ 8000ï¼‰</li>
              <li>åœ¨æ¯”èµ›ç®¡ç†é¡µé¢å¯»æ‰¾ "æŠ„è¢­æ£€æµ‹" å…¥å£</li>
              <li>ä¸Šä¼ æ¯”èµ›æäº¤æ•°æ®åˆ° MongoDB</li>
              <li>è¿è¡ŒæŠ„è¢­æ£€æµ‹åˆ†æ</li>
              <li>æŸ¥çœ‹è¯¦ç»†çš„æ£€æµ‹ç»“æœ</li>
            </ol>
            
            <h3>ğŸ”§ é…ç½®ä¿¡æ¯</h3>
            <ul>
              <li><strong>API åœ°å€:</strong> <code>{{ apiBase or 'http://localhost:8000' }}</code></li>
              <li><strong>æ”¯æŒè¯­è¨€:</strong> Java, C++, Python, C, JavaScript</li>
              <li><strong>æ£€æµ‹å¼•æ“:</strong> JPlag 6.2.0</li>
            </ul>
            
            <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
            <div class="button-group">
              <a href="/contest" class="rounded button">
                <span class="icon icon-trophy"></span>
                æŸ¥çœ‹æ¯”èµ›åˆ—è¡¨
              </a>
              <a href="https://github.com/CAUCOJ/Phosphorus" class="rounded button" target="_blank">
                <span class="icon icon-external-link"></span>
                æŸ¥çœ‹æ–‡æ¡£
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('test-api').addEventListener('click', async function() {
    const button = this;
    const resultDiv = document.getElementById('api-result');
    
    button.disabled = true;
    button.textContent = 'æµ‹è¯•ä¸­...';
    resultDiv.innerHTML = '';
    
    try {
        const apiBase = '{{ apiBase or "http://localhost:8000" }}';
        const response = await fetch(`${apiBase}/health`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            resultDiv.innerHTML = `
                <div class="typo">
                    <blockquote class="success">
                        <p><strong>âœ… è¿æ¥æˆåŠŸï¼</strong></p>
                        <p>Phosphorus åç«¯æœåŠ¡æ­£åœ¨æ­£å¸¸è¿è¡Œã€‚</p>
                        <p>æœåŠ¡çŠ¶æ€: ${data.status || 'OK'}</p>
                    </blockquote>
                </div>
            `;
        } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="typo">
                <blockquote class="warn">
                    <p><strong>âŒ è¿æ¥å¤±è´¥</strong></p>
                    <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    <p>è¯·æ£€æŸ¥ Phosphorus åç«¯æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚</p>
                </blockquote>
            </div>
        `;
    } finally {
        button.disabled = false;
        button.textContent = 'æµ‹è¯• API è¿æ¥';
    }
});
</script>
{% endblock %}
